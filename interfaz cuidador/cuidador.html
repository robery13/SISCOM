<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SISCOM - Portal del Paciente</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Estilos propios -->
  <link rel="stylesheet" href="estilospaciente.css" />
</head>
<body>

  <!-- Botón para abrir menú en móvil -->
<button class="menu-toggle" id="menuToggle">
  <i class="bi bi-list"></i>
</button>

<!-- Overlay para cerrar menú al hacer clic fuera -->
<div class="overlay" id="overlay"></div>

  <div class="app">

    <!-- BARRA LATERAL -->
    <aside class="sidebar">
      <div class="brand">SISCOM</div>

      <nav class="nav-menu">
        <button class="nav-btn active" data-section="inicio"><i class="bi bi-house-door"></i> <span>Inicio</span></button>
        <button class="nav-btn" data-section="recetas"><i class="bi bi-prescription2"></i> <span>Recetas Médicas</span></button>
        <button class="nav-btn" data-section="agenda"><i class="bi bi-calendar-check"></i> <span>Agenda Médica</span></button>
        <button class="nav-btn" data-section="recompensas"><i class="bi bi-trophy"></i> <span>Recompensas</span></button>
        <button class="nav-btn" data-section="emergencia"><i class="bi bi-mic-fill"></i> <span>Emergencia</span></button>
        <button class="nav-btn" id="cerrarSesionBtn"><i class="bi bi-box-arrow-right"></i> <span>Cerrar Sesión</span></button>
      </nav>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main">

   <!-- SECCIÓN INICIO -->
<section id="inicio" class="section">
  <div class="section-header">
    <h2>Inicio</h2>
    <p class="muted">Bienvenido a tu panel de control</p>
  </div>

  <div class="card">
    <h5 class="card-title">Panel de Control</h5>
    <div class="row">
      <div class="col-md-3 col-6 mb-3">
        <div class="p-4 bg-primary text-white rounded text-center">
          <i class="bi bi-prescription2" style="font-size: 2.5rem;"></i>
          <h3 class="mt-2" id="stat-recetas">0</h3>
          <p class="mb-0">Recetas Activas</p>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="p-4 bg-success text-white rounded text-center">
          <i class="bi bi-calendar-check" style="font-size: 2.5rem;"></i>
          <h3 class="mt-2" id="stat-citas">0</h3>
          <p class="mb-0">Citas Próximas</p>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="p-4 bg-warning text-white rounded text-center">
          <i class="bi bi-star-fill" style="font-size: 2.5rem;"></i>
          <h3 class="mt-2" id="stat-puntos">0</h3>
          <p class="mb-0">Puntos</p>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="p-4 bg-info text-white rounded text-center">
          <i class="bi bi-graph-up" style="font-size: 2.5rem;"></i>
          <h3 class="mt-2" id="stat-cumplimiento">0%</h3>
          <p class="mb-0">Cumplimiento</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8 mb-3">
      <div class="card">
        <h5 class="card-title">Mis Medicamentos de Hoy</h5>
        <div id="listaMedicamentosHoy" class="list-group list-group-flush">
          <div class="list-group-item text-center text-muted">
            Cargando medicamentos...
          </div>
        </div>
      </div>

      <div class="card">
        <h5 class="card-title">Tomas Registradas Hoy</h5>
        <div id="listaTomasHoy" class="list-group list-group-flush">
          <div class="list-group-item text-center text-muted">
            Aún no has registrado ninguna toma
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card bg-danger text-white">
        <h5 class="card-title">Emergencia</h5>
        <p>¿Necesitas ayuda inmediata?</p>
        <button class="btn btn-light btn-lg w-100" onclick="irASeccionEmergencia()">
          <i class="bi bi-telephone-fill"></i> Activar Emergencia
        </button>
      </div>
      
      <div class="card mt-3">
        <h5 class="card-title">Próxima Cita</h5>
        <div id="proximaCita" class="text-center">
          <p class="text-muted">Sin citas próximas</p>
        </div>
      </div>

      <div class="card mt-3">
        <h5 class="card-title">Logro Reciente</h5>
        <div id="logroReciente" class="text-center">
          <i class="bi bi-trophy-fill text-warning" style="font-size: 3rem;"></i>
          <p class="mt-2 mb-0"><strong>Sigue así</strong></p>
          <small class="text-muted">Completa tus medicamentos</small>
        </div>
      </div>
    </div>
  </div>
</section>

      <!-- SECCIÓN RECETAS MÉDICAS -->
      <section id="recetas" class="section d-none">
        <div class="section-header">
          <h2><i class="bi bi-prescription2"></i> Recetas Médicas</h2>
          <p class="muted">Gestiona y sube tus recetas médicas</p>
        </div>

        <div class="card">
          <h5 class="card-title">Subir Nueva Receta</h5>
          <div class="mb-3">
            <label class="form-label">Selecciona o escanea tu receta</label>
            <input type="file" class="form-control" accept="image/*,.pdf" id="recetaInput">
          </div>
          <button class="btn btn-primary w-100 w-md-auto"><i class="bi bi-upload"></i> Cargar Receta</button>
        </div>

        <div class="card">
          <h5 class="card-title">Mis Recetas</h5>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Medicamento</th>
                  <th>Dosis</th>
                  <th>Frecuencia</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>15/11/2024</td>
                  <td>Ibuprofeno</td>
                  <td>400mg</td>
                  <td>Cada 8 horas</td>
                  <td>
                    <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i></button>
                    <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                  </td>
                </tr>
                <tr>
                  <td>20/11/2024</td>
                  <td>Losartán</td>
                  <td>50mg</td>
                  <td>Cada 12 horas</td>
                  <td>
                    <button class="btn btn-sm btn-info"><i class="bi bi-eye"></i></button>
                    <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- HU-16: HISTORIAL DE MEDICACIÓN -->
        <div class="card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0"><i class="bi bi-clock-history"></i> Historial de Medicación</h5>
            <button class="btn btn-sm btn-outline-primary" onclick="exportarHistorialPDF()">
              <i class="bi bi-download"></i> Exportar
            </button>
          </div>
          <div id="historialMedicacion">
            <p class="text-muted">Cargando historial...</p>
          </div>
        </div>
      </section>

      <!-- SECCIÓN AGENDA MÉDICA -->
      <section id="agenda" class="section d-none">
        <div class="section-header">
          <h2><i class="bi bi-calendar-check"></i> Agenda Médica</h2>
          <p class="muted">Gestiona tus citas médicas</p>
        </div>

        <div class="card">
          <h5 class="card-title">Registrar Nueva Cita</h5>
          <form id="citaForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Fecha</label>
                <input type="date" class="form-control" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Hora</label>
                <input type="time" class="form-control" required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Especialidad/Motivo</label>
              <select class="form-select" id="selectEspecialidad" required>
                <option value="">Selecciona una especialidad</option>
                <optgroup label="Especialidades Médicas">
                  <option value="Medicina General">Medicina General</option>
                  <option value="Cardiología">Cardiología</option>
                  <option value="Neurología">Neurología</option>
                  <option value="Medicina Interna">Medicina Interna</option>
                  <option value="Endocrinología">Endocrinología</option>
                  <option value="Geriatría">Geriatría</option>
                  <option value="Psiquiatría">Psiquiatría</option>
                  <option value="Ortopedia">Ortopedia</option>
                </optgroup>
                <optgroup label="Servicios de Enfermería">
                  <option value="Control de Signos Vitales">Control de Signos Vitales</option>
                  <option value="Administración de Medicamentos">Administración de Medicamentos</option>
                  <option value="Curación de Heridas">Curación de Heridas</option>
                  <option value="Toma de Muestras">Toma de Muestras</option>
                  <option value="Control de Glucosa">Control de Glucosa</option>
                </optgroup>
                <optgroup label="Servicios de Cuidado">
                  <option value="Cuidado Personal">Cuidado Personal</option>
                  <option value="Acompañamiento">Acompañamiento</option>
                  <option value="Asistencia en Movilidad">Asistencia en Movilidad</option>
                  <option value="Apoyo en Alimentación">Apoyo en Alimentación</option>
                  <option value="Supervisión General">Supervisión General</option>
                </optgroup>
                <optgroup label="Otros">
                  <option value="Consulta de Seguimiento">Consulta de Seguimiento</option>
                  <option value="Revisión de Tratamiento">Revisión de Tratamiento</option>
                  <option value="Evaluación General">Evaluación General</option>
                </optgroup>
              </select>
            </div>
            <div class="mb-3">
         <label class="form-label">Doctor o Cuidador</label>
              <select class="form-select" id="selectDoctor" required>
                <option value="">Selecciona un profesional</option>
                <optgroup label="Médicos">
                <option value="Dr. Juan Pérez - Médico General">Dr. Juan Pérez - Médico General</option>
      <option value="Dra. María López - Cardióloga">Dra. María López - Cardióloga</option>
      <option value="Dr. Carlos Rodríguez - Neurólogo">Dr. Carlos Rodríguez - Neurólogo</option>
      <option value="Dr. Roberto Fernández - Internista">Dr. Roberto Fernández - Internista</option>
      <option value="Dra. Patricia Morales - Endocrinóloga">Dra. Patricia Morales - Endocrinóloga</option>
      <option value="Dr. Luis Hernández - Geriatra">Dr. Luis Hernández - Geriatra</option>
      <option value="Dra. Carmen Díaz - Psiquiatra">Dra. Carmen Díaz - Psiquiatra</option>
      <option value="Dr. Miguel Ángel Torres - Ortopedista">Dr. Miguel Ángel Torres - Ortopedista</option>
    </optgroup>
    <optgroup label="Cuidadores">
      <option value="Enfermera Ana García">Enfermera Ana García</option>
      <option value="Cuidador Pedro Martínez">Cuidador Pedro Martínez</option>
      <option value="Enfermera Laura Sánchez">Enfermera Laura Sánchez</option>
      <option value="Enfermero José Ramírez">Enfermero José Ramírez</option>
      <option value="Cuidadora Sofia Castillo">Cuidadora Sofia Castillo</option>
      <option value="Enfermera Gabriela Núñez">Enfermera Gabriela Núñez</option>
      <option value="Cuidador Antonio Vargas">Cuidador Antonio Vargas</option>
      <option value="Enfermera Rosa Mendoza">Enfermera Rosa Mendoza</option>
    </optgroup>
              </select>
            </div>
            <button type="submit" class="btn btn-primary"><i class="bi bi-calendar-plus"></i> Agendar Cita</button>
          </form>
        </div>

        <div class="card">
          <h5 class="card-title">Próximas Citas</h5>
          <div class="alert alert-info">
            <i class="bi bi-bell"></i> Tienes 2 citas próximas esta semana
          </div>
          <div class="list-group">
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">Consulta General</h6>
                  <small class="text-muted"><i class="bi bi-calendar3"></i> 05/12/2024 - 10:00 AM</small><br>
                  <small class="text-muted"><i class="bi bi-person"></i> Dr. Juan Pérez</small>
                </div>
                <button class="btn btn-sm btn-outline-danger"><i class="bi bi-x-circle"></i> Cancelar</button>
              </div>
            </div>
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">Cardiología - Control</h6>
                  <small class="text-muted"><i class="bi bi-calendar3"></i> 07/12/2024 - 3:00 PM</small><br>
                  <small class="text-muted"><i class="bi bi-person"></i> Dra. María López</small>
                </div>
                <button class="btn btn-sm btn-outline-danger"><i class="bi bi-x-circle"></i> Cancelar</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECCIÓN RECOMPENSAS -->
      <section id="recompensas" class="section d-none">
        <div class="section-header">
          <h2><i class="bi bi-trophy"></i> Sistema de Recompensas</h2>
          <p class="muted">Gana puntos por cumplir con tu tratamiento</p>
        </div>

        <div class="card">
          <h5 class="card-title">Tu Progreso</h5>
          <div class="row text-center mb-4">
            <div class="col-md-4">
              <div class="p-3 bg-light rounded">
                <i class="bi bi-star-fill text-warning" style="font-size: 2rem;"></i>
                <h3 class="mt-2">350</h3>
                <small class="text-muted">Puntos totales</small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 bg-light rounded">
                <i class="bi bi-award-fill text-primary" style="font-size: 2rem;"></i>
                <h3 class="mt-2">5</h3>
                <small class="text-muted">Medallas</small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 bg-light rounded">
                <i class="bi bi-graph-up text-success" style="font-size: 2rem;"></i>
                <h3 class="mt-2">85%</h3>
                <small class="text-muted">Cumplimiento</small>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="mb-2">Progreso a siguiente nivel</label>
            <div class="progress" style="height: 25px;">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 70%">70%</div>
            </div>
            <small class="text-muted">150 puntos más para nivel 4</small>
          </div>
        </div>

        <div class="card">
          <h5 class="card-title">Medallas Obtenidas</h5>
          <div class="row">
            <div class="col-md-4 text-center mb-3">
              <i class="bi bi-calendar-check-fill text-success" style="font-size: 3rem;"></i>
              <p class="mt-2 mb-0"><strong>Semana Perfecta</strong></p>
              <small class="text-muted">7 días consecutivos</small>
            </div>
            <div class="col-md-4 text-center mb-3">
              <i class="bi bi-clock-history text-info" style="font-size: 3rem;"></i>
              <p class="mt-2 mb-0"><strong>Puntual</strong></p>
              <small class="text-muted">Siempre a tiempo</small>
            </div>
            <div class="col-md-4 text-center mb-3">
              <i class="bi bi-fire text-danger" style="font-size: 3rem;"></i>
              <p class="mt-2 mb-0"><strong>Racha de 30</strong></p>
              <small class="text-muted">30 días seguidos</small>
            </div>
          </div>
        </div>

        <div class="card">
          <h5 class="card-title">Logros Recientes</h5>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <i class="bi bi-check-circle-fill text-success"></i> Tomaste todos tus medicamentos del día - <strong>+10 puntos</strong>
              <small class="text-muted d-block">Hace 2 horas</small>
            </li>
            <li class="list-group-item">
              <i class="bi bi-trophy-fill text-warning"></i> Completaste una semana perfecta - <strong>+50 puntos</strong>
              <small class="text-muted d-block">Hace 1 día</small>
            </li>
            <li class="list-group-item">
              <i class="bi bi-star-fill text-info"></i> 5 días seguidos tomando medicamento a tiempo - <strong>+25 puntos</strong>
              <small class="text-muted d-block">Hace 3 días</small>
            </li>
          </ul>
        </div>
      </section>

      <!-- SECCIÓN EMERGENCIA -->
      <section id="emergencia" class="section d-none">
        <div class="section-header">
          <h2><i class="bi bi-exclamation-triangle-fill"></i> Activación de Emergencia</h2>
          <p class="muted">Activa ayuda de emergencia por voz o botón</p>
        </div>

        <div class="card text-center">
          <h5 class="card-title">Botón de Emergencia</h5>
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill"></i> Usa este botón solo en caso de emergencia real
          </div>
          
          <div class="d-flex justify-content-center mb-4">
            <button class="btn-emergencia-sos" id="emergenciaBtn">
              <div class="sos-icon">
                <i class="bi bi-telephone-fill"></i>
              </div>
              <div class="sos-text">SOS</div>
              <div class="sos-subtext">EMERGENCIA</div>
            </button>
          </div>

          <div class="mb-4">
            <h6>O usa el comando de voz:</h6>
            <p class="text-muted">"Ayuda", "Emergencia" o "SOS"</p>
            <button class="btn btn-outline-primary" id="activarVozBtn">
              <i class="bi bi-mic"></i> Activar Reconocimiento de Voz
            </button>
            <div id="vozStatus" class="mt-2"></div>
          </div>
        </div>

        <div class="card">
          <h5 class="card-title">Contactos de Emergencia</h5>
          <div class="list-group">
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-0">Dr. Juan Pérez (Médico Personal)</h6>
                  <small class="text-muted"><i class="bi bi-telephone"></i> +504 9999-9999</small>
                </div>
                <button class="btn btn-sm btn-success"><i class="bi bi-telephone-fill"></i> Llamar</button>
              </div>
            </div>
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-0">Familiar: María González</h6>
                  <small class="text-muted"><i class="bi bi-telephone"></i> +504 8888-8888</small>
                </div>
                <button class="btn btn-sm btn-success"><i class="bi bi-telephone-fill"></i> Llamar</button>
              </div>
            </div>
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-0">Emergencias 911</h6>
                  <small class="text-muted"><i class="bi bi-telephone"></i> 911</small>
                </div>
                <button class="btn btn-sm btn-danger"><i class="bi bi-telephone-fill"></i> Llamar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- HU-15: HISTORIAL DE EMERGENCIAS -->
        <div class="card">
          <h5 class="card-title"><i class="bi bi-clock-history"></i> Historial de Emergencias</h5>
          <p class="text-muted small">Registro de tus activaciones de emergencia</p>
          <div id="historialEmergencias" class="list-group">
            <p class="text-muted">Cargando historial...</p>
          </div>
        </div>

        <div class="card">
          <h5 class="card-title">Configuración de Seguridad</h5>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="vozSwitch" checked>
            <label class="form-check-label" for="vozSwitch">Permitir activación por voz</label>
          </div>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="ubicacionSwitch" checked>
            <label class="form-check-label" for="ubicacionSwitch">Compartir ubicación en emergencia</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notificarSwitch" checked>
            <label class="form-check-label" for="notificarSwitch">Notificar a todos los contactos</label>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Script propio -->
  <script src="scriptpaciente.js"></script>
  
  <!-- Scripts adicionales para cargar historiales -->
  <script>
    // Cargar historial al entrar a la sección de recetas
    document.querySelector('.nav-btn[data-section="recetas"]')?.addEventListener('click', () => {
      setTimeout(() => {
        if (typeof cargarHistorialMedicacion === 'function') {
          cargarHistorialMedicacion();
        }
      }, 300);
    });

    // Cargar historial al entrar a la sección de emergencia
    document.querySelector('.nav-btn[data-section="emergencia"]')?.addEventListener('click', () => {
      setTimeout(() => {
        if (typeof cargarHistorialEmergencias === 'function') {
          cargarHistorialEmergencias();
        }
      }, 300);
    });
  </script>
</body>
</html>